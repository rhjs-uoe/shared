%%% single-line packages %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[utf8]{inputenc}
\usepackage{standalone}
%\usepackage{babel}% For multilingual/non-English documents.
%\usepackage{csquotes}% Load if you want non-English quotes.
%\usepackage{xpatch}% For some biblatex styles, this is required. Not for the core ones.
%\usepackage[backend=biber,style=alphabetic]{biblatex}% Biblatex+Biber setup. Your document will now take a while to compile.
%\usepackage{graphicx}

%%% Isabelle Listings %%%
%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{lisa}% includes amssymb, fancyvrb, listings, xcolor, bigfoot, ltxcmds

%%% hyperref %%%
%%%%%%%%%%%%%%%%
\usepackage{hyperref}
% This colours the hyperlinks, which is better for screen reading. COMMENT for printing/colorblind-friendliness.
\hypersetup{
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}

%%% AMS packages %%%
%%%%%%%%%%%%%%%%%%%%
\usepackage{physics}% includes amsmath, great for \bra and \ket etc.
\usepackage{mathtools}
\usepackage{amsthm}
% additional symbol definitions
\newcommand\restr[2]{{% we make the whole thing an ordinary symbol
  \left.\kern-\nulldelimiterspace % automatically resize the bar with \right
  #1 % the function
  \vphantom{\big|} % pretend it's a little taller at normal size - comment if not wanted
  \right|_{#2} % this is the delimiter
}}

% Environment definitions, mostly standard
\theoremstyle{plain}% default
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem*{corollary}{Corollary}

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{axiom}{Axiom}[section]
\newtheorem{example}{Example}[section]
\newtheorem{exercise}[example]{Exercise}

\theoremstyle{remark}
\newtheorem*{remark}{Remark}
%\newtheorem*{note}{Note} % Notes are already defined in beamer - I think for presentor mode?

% TODO look into the cleveref package and hyperref's \autoref
%%% fancyref %%%
%%%%%%%%%%%%%%%%
\usepackage[plain]{fancyref}% tight spacing because I use abbreviated cross references, e.g. Fig. 1
{%%% old format -- short, abbreviated names, grammatical capitalisation only, tight spacing %%%
%% new prefixes
%\newcommand*{\fancyrefthmlabelprefix}{thm}
%\newcommand*{\fancyrefdeflabelprefix}{def}
%\newcommand*{\fancyrefeqnlabelprefix}{eqn}
%\newcommand*{\fancyreflinelabelprefix}{line}
% spacing used in all commands, not just the ones (re)defined below
%\renewcommand*{\fancyrefdefaultspacing}{\fancyreftightspacing}
%% new names and formats
%\newcommand*{\Frefdefname}{Def.}
%\newcommand*{\frefdefname}{def.}
%\frefformat{plain}{\fancyrefdeflabelprefix}{\frefdefname\fancyrefdefaultspacing#1}
%\Frefformat{plain}{\fancyrefdeflabelprefix}{\Frefdefname\fancyrefdefaultspacing#1}
%\newcommand*{\Frefeqnname}{Eqn.}
%\newcommand*{\frefeqnname}{eqn.}
%\frefformat{plain}{\fancyrefeqnlabelprefix}{\frefeqnname\fancyrefdefaultspacing#1}
%\Frefformat{plain}{\fancyrefeqnlabelprefix}{\Frefeqnname\fancyrefdefaultspacing#1}
%\newcommand*{\Freflinename}{Line}
%\newcommand*{\freflinename}{line}
%\frefformat{plain}{\fancyreflinelabelprefix}{\freflinename\fancyrefloosespacing#1}
%\Frefformat{plain}{\fancyreflinelabelprefix}{\Freflinename\fancyrefloosespacing#1}
%% existing name (and format?) changes (here, shortened)
%%\renewcommand*{\Frefeqname}{Eqn.}
%\renewcommand*{\Frefsecname}{Sec.}
%\renewcommand*{\Freftabname}{Tab.}
%\renewcommand*{\Freffigname}{Fig.}
}
% new prefixes
\newcommand*{\fancyrefthmlabelprefix}{thm}
\newcommand*{\fancyreflemlabelprefix}{lem}
\newcommand*{\fancyrefapplabelprefix}{app}
\newcommand*{\fancyrefdeflabelprefix}{def}
\newcommand*{\fancyrefeqnlabelprefix}{eqn}
\newcommand*{\fancyreflinelabelprefix}{line}
% spacing used in all commands, not just the ones (re)defined below
\renewcommand*{\fancyrefdefaultspacing}{\fancyrefloosespacing}
% new names and formats
\newcommand*{\Frefdefname}{Definition}
\newcommand*{\frefdefname}{definition}
\frefformat{plain}{\fancyrefdeflabelprefix}{\frefdefname\fancyrefdefaultspacing#1}
\Frefformat{plain}{\fancyrefdeflabelprefix}{\Frefdefname\fancyrefdefaultspacing#1}
\newcommand*{\Frefappname}{Appendix}
\newcommand*{\frefappname}{appendix}
\frefformat{plain}{\fancyrefapplabelprefix}{\frefappname\fancyrefdefaultspacing#1}
\Frefformat{plain}{\fancyrefapplabelprefix}{\Frefappname\fancyrefdefaultspacing#1}
\newcommand*{\Frefeqnname}{Equation}
\newcommand*{\frefeqnname}{equation}
\frefformat{plain}{\fancyrefeqnlabelprefix}{\frefeqnname\fancyrefdefaultspacing#1}
\Frefformat{plain}{\fancyrefeqnlabelprefix}{\Frefeqnname\fancyrefdefaultspacing#1}
\newcommand*{\Freflemname}{Lemma}
\newcommand*{\freflemname}{lemma}
\frefformat{plain}{\fancyreflemlabelprefix}{\freflemname\fancyrefdefaultspacing#1}
\Frefformat{plain}{\fancyreflemlabelprefix}{\Freflemname\fancyrefdefaultspacing#1}
\newcommand*{\Frefthmname}{Theorem}
\newcommand*{\frefthmname}{theorem}
\frefformat{plain}{\fancyrefthmlabelprefix}{\frefthmname\fancyrefdefaultspacing#1}
\Frefformat{plain}{\fancyrefthmlabelprefix}{\Frefthmname\fancyrefdefaultspacing#1}
\newcommand*{\Freflinename}{Line}
\newcommand*{\freflinename}{line}
\frefformat{plain}{\fancyreflinelabelprefix}{\freflinename\fancyrefloosespacing#1}
\Frefformat{plain}{\fancyreflinelabelprefix}{\Freflinename\fancyrefloosespacing#1}
% existing name (and format?) changes (here, shortened)
%\renewcommand*{\Frefeqname}{Eqn.}
\renewcommand*{\Frefsecname}{Section}
\renewcommand*{\Freftabname}{Table}
\renewcommand*{\Freffigname}{Figure}
% Capitalise everything!
\renewcommand{\fref}{\Fref}

%%% TiKZ %%%
\usepackage{tikz}
%\usetikzlibrary{arrows}
\usetikzlibrary{cd}
\usetikzlibrary{decorations.pathreplacing,calc} % needed for braces across itemize (below)
\usetikzlibrary{tikzmark} % needed for drawing rectangles around highlights in lstlistings

%%% mathtools %%%
%%%%%%%%%%%%%%%%%
\usepackage{mathtools}
\DeclarePairedDelimiter{\all}{\forall}{.\quad}
\DeclarePairedDelimiter{\any}{\exists}{.\quad}
%%% strikeout in math mode
% from : https://tex.stackexchange.com/a/20613
\newcommand\hcancel[2][black]{\setbox0=\hbox{$#2$}%
\rlap{\raisebox{.45\ht0}{\textcolor{#1}{\rule{\wd0}{1pt}}}}#2}


%%% Symbol shortcuts and custom commands %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\setN}{{\mathord{\mathbb N}}}
\newcommand{\setZ}{{\mathord{\mathbb Z}}}
\newcommand{\setQ}{{\mathord{\mathbb Q}}}
\newcommand{\setR}{{\mathord{\mathbb R}}}
\newcommand{\setC}{{\mathord{\mathbb C}}}
\newcommand{\setH}{{\mathord{\mathbb H}}}

\def\ie/{\textit{i}.\textit{e}.}
\def\eg/{\textit{e}.\textit{g}.}
\def\cf/{\textit{cf}.}

%%% Drawing rectangles to highlight parts of listings %%%
\newcounter{lstmark}
\newcommand{\tmark}[2][0pt]{%tikzmark
    \stepcounter{lstmark}%
    \if###2##%
    \else
        #2%
    \fi
    \tikz[overlay,remember picture]\node (\thelstmark){};%
}
\newcommand{\makehl}[3][0pt]{%make highlight
    \begin{tikzpicture}[overlay, remember picture]
        \draw[red,rounded corners]
          let \p1=(#2), \p2=(#3) in
          ({\x1-3pt}, {\y1+1.65ex})
            rectangle
          ({\x2+3pt}, {\y2-0.65ex});
    \end{tikzpicture}%
}

%%% Braces over multiple itemized items %%%
\newcounter{itemnum}
\newcommand{\nt}[2][0pt]{%
    \stepcounter{itemnum}%
    \if###2##%
    \else
        #2%
        \thinspace
    \fi
    \tikz[overlay,remember picture,baseline=(\theitemnum.base),xshift=#1]\node (\theitemnum){};%
}
\newcommand{\makebrace}[4][0pt]{%
    \begin{tikzpicture}[overlay, remember picture]
        \draw [decoration={brace,amplitude=0.5em},decorate]
        let \p1=(#2), \p2=(#3) in
        ({max(\x1+#1,\x2+#1)}, {\y1+1.75ex}) --
            node[right=0.6em] {#4} ({max(\x1+#1,\x2+#1)}, {\y2-0.5ex});
    \end{tikzpicture}%
}
\newenvironment{braceitems}{%
    \begin{enumerate}
}{%
    \end{enumerate}
    \setcounter{itemnum}{0}%
}
